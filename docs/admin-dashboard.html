<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Nail Admin Playground</title>
  <style>
    :root {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #1f2933;
      background: #f6f7fb;
    }
    body {
      margin: 0;
      padding: 24px;
    }
    h1, h2 {
      margin-bottom: 0.3rem;
    }
    section {
      background: #fff;
      border-radius: 12px;
      padding: 18px 20px 24px;
      margin-bottom: 24px;
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.08);
    }
    form {
      display: grid;
      gap: 12px;
      margin-bottom: 16px;
    }
    label {
      font-weight: 600;
      font-size: 0.92rem;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #cfd6e4;
      font-size: 0.95rem;
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: #2563eb;
      color: #fff;
      font-size: 0.95rem;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }
    button:hover { opacity: 0.9; }
    .grid {
      display: grid;
      gap: 18px;
    }
    .grid-2 {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    pre {
      background: #0f172a;
      color: #d1d5db;
      padding: 14px;
      border-radius: 10px;
      overflow-x: auto;
      max-height: 360px;
    }
    .inline {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .inline input {
      flex: 1;
    }
    small {
      color: #5f6b7c;
    }
  </style>
</head>
<body>
  <h1>Admin API Playground</h1>
  <p>使用固定的 Base URL 与 Bearer Token（管理员登录返回的 `token`）。请求走浏览器 `fetch`，可以直接观察响应。</p>

  <section>
    <h2>全局配置</h2>
    <div class="grid grid-2">
      <div>
        <label>Base URL</label>
        <input id="baseUrl" value="http://localhost:8080" />
        <small>例如生产环境可改为 https://api.example.com</small>
      </div>
      <div>
        <label>Admin JWT Token</label>
        <input id="tokenInput" placeholder="Bearer token ..." />
        <small>来自 `/api/v1/auth/login` 的 `token` 字段</small>
      </div>
    </div>
  </section>

  <section>
    <h2>商品管理</h2>
    <div class="grid grid-2">
      <form id="createProductForm">
        <h3>创建商品</h3>
        <label>名称</label>
        <input name="name" required />
        <label>分类</label>
        <input name="category" required />
        <label>价格（分）</label>
        <input name="priceCents" type="number" required />
        <button type="submit">创建</button>
      </form>

      <form id="updateProductForm">
        <h3>更新商品</h3>
        <label>商品 ID</label>
        <input name="id" type="number" required />
        <label>名称（可空）</label>
        <input name="name" />
        <label>分类（可空）</label>
        <input name="category" />
        <label>价格（分，可空）</label>
        <input name="priceCents" type="number" />
        <label>状态（ON/OFF，可空）</label>
        <select name="status">
          <option value="">-- 不修改 --</option>
          <option value="ON">ON</option>
          <option value="OFF">OFF</option>
        </select>
        <button type="submit">更新</button>
      </form>
    </div>

    <form id="listProductsForm">
      <h3>分页查询商品</h3>
      <div class="inline">
        <label>页码</label>
        <input name="page" type="number" value="0" min="0" />
        <label>每页</label>
        <input name="size" type="number" value="10" min="1" />
        <button type="submit">查询</button>
      </div>
    </form>

    <form id="addProductImageForm">
      <h3>添加商品图片</h3>
      <label>商品 ID</label>
      <input name="id" type="number" required />
      <label>图片 URL</label>
      <input name="url" required />
      <label>是否封面</label>
      <select name="cover">
        <option value="false">false</option>
        <option value="true">true</option>
      </select>
      <label>排序序号</label>
      <input name="sortOrder" type="number" value="0" />
      <button type="submit">上传图片</button>
    </form>
  </section>

  <section>
    <h2>服务管理</h2>
    <div class="grid grid-2">
      <form id="createServiceForm">
        <h3>创建服务</h3>
        <label>分类</label>
        <input name="category" required />
        <label>价格（分）</label>
        <input name="priceCents" type="number" required />
        <label>描述</label>
        <textarea name="description" rows="3" required></textarea>
        <label>预计分钟数</label>
        <input name="estimatedMinutes" type="number" value="60" required />
        <button type="submit">创建</button>
      </form>

      <form id="updateServiceForm">
        <h3>更新服务</h3>
        <label>服务 ID</label>
        <input name="id" type="number" required />
        <label>分类（可空）</label>
        <input name="category" />
        <label>价格（分，可空）</label>
        <input name="priceCents" type="number" />
        <label>描述（可空）</label>
        <textarea name="description" rows="3"></textarea>
        <label>状态（ON/OFF，可空）</label>
        <select name="status">
          <option value="">-- 不修改 --</option>
          <option value="ON">ON</option>
          <option value="OFF">OFF</option>
        </select>
        <label>预计分钟数（可空）</label>
        <input name="estimatedMinutes" type="number" />
        <button type="submit">更新</button>
      </form>
    </div>

    <form id="listServicesForm">
      <h3>分页查询服务</h3>
      <div class="inline">
        <label>页码</label>
        <input name="page" type="number" value="0" min="0" />
        <label>每页</label>
        <input name="size" type="number" value="10" min="1" />
        <button type="submit">查询</button>
      </div>
    </form>

    <form id="addServiceImageForm">
      <h3>添加服务图片</h3>
      <label>服务 ID</label>
      <input name="id" type="number" required />
      <label>图片 URL</label>
      <input name="url" required />
      <label>是否封面</label>
      <select name="cover">
        <option value="false">false</option>
        <option value="true">true</option>
      </select>
      <label>排序序号</label>
      <input name="sortOrder" type="number" value="0" />
      <button type="submit">上传图片</button>
    </form>
  </section>

  <section>
    <h2>订单运营</h2>
    <form id="listOrdersForm">
      <h3>分页查询订单</h3>
      <div class="grid grid-2">
        <div>
          <label>页码</label>
          <input name="page" type="number" value="0" min="0" />
        </div>
        <div>
          <label>每页</label>
          <input name="size" type="number" value="10" min="1" />
        </div>
        <div>
          <label>状态过滤（可空）</label>
          <select name="status">
            <option value="">-- 全部 --</option>
            <option value="PENDING_CONFIRM">PENDING_CONFIRM</option>
            <option value="AWAITING">AWAITING</option>
            <option value="COMPLETED">COMPLETED</option>
            <option value="CANCELLED">CANCELLED</option>
            <option value="REFUNDED">REFUNDED</option>
          </select>
        </div>
      </div>
      <button type="submit">查询</button>
    </form>

    <div class="grid grid-2">
      <form data-action="/orders/{id}/confirm" class="orderActionForm">
        <h3>确认订单</h3>
        <label>订单 ID</label>
        <input name="orderId" type="number" required />
        <button type="submit">Confirm</button>
      </form>

      <form data-action="/orders/{id}/cancel" class="orderActionForm">
        <h3>取消订单</h3>
        <label>订单 ID</label>
        <input name="orderId" type="number" required />
        <button type="submit">Cancel</button>
      </form>

      <form data-action="/orders/{id}/ship" class="orderActionForm extraPayload">
        <h3>发货</h3>
        <label>订单 ID</label>
        <input name="orderId" type="number" required />
        <label>快递单号</label>
        <input name="trackingNo" required />
        <button type="submit">Ship</button>
      </form>

      <form data-action="/orders/{id}/complete" class="orderActionForm">
        <h3>完成订单</h3>
        <label>订单 ID</label>
        <input name="orderId" type="number" required />
        <button type="submit">Complete</button>
      </form>

      <form data-action="/orders/{id}/refund" class="orderActionForm extraPayload">
        <h3>退款</h3>
        <label>订单 ID</label>
        <input name="orderId" type="number" required />
        <label>退款金额（分）</label>
        <input name="amountCents" type="number" required />
        <label>原因</label>
        <input name="reason" required />
        <button type="submit">Refund</button>
      </form>

      <form id="getOrderDetailForm">
        <h3>订单详情</h3>
        <label>订单 ID</label>
        <input name="orderId" type="number" required />
        <button type="submit">查询详情</button>
      </form>
    </div>
  </section>

  <section>
    <h2>响应输出</h2>
    <p>最近一次 API 响应内容：</p>
    <pre id="output">等待调用...</pre>
  </section>

  <script>
    const output = document.getElementById('output');
    const baseUrlEl = document.getElementById('baseUrl');
    const tokenEl = document.getElementById('tokenInput');

    async function apiRequest(method, path, body, query = {}) {
      const baseUrl = baseUrlEl.value.replace(/\/$/, '');
      const token = tokenEl.value.trim();
      const search = new URLSearchParams();
      Object.entries(query).forEach(([key, value]) => {
        if (value !== undefined && value !== null && value !== '') {
          search.append(key, value);
        }
      });
      const url = `${baseUrl}/api/v1/admin${path}${search.toString() ? '?' + search.toString() : ''}`;

      const res = await fetch(url, {
        method,
        headers: {
          'Content-Type': 'application/json',
          ...(token ? { Authorization: `Bearer ${token}` } : {})
        },
        body: body ? JSON.stringify(body) : undefined
      });
      const text = await res.text();
      let json;
      try { json = JSON.parse(text); } catch { json = text; }
      output.textContent = JSON.stringify({
        status: res.status,
        ok: res.ok,
        body: json
      }, null, 2);
      if (!res.ok) throw new Error(`请求失败 ${res.status}`);
      return json;
    }

    function formToPayload(form) {
      const data = {};
      new FormData(form).forEach((value, key) => {
        if (value === '' || value === null) return;
        if (key === 'priceCents' || key === 'estimatedMinutes' || key === 'sortOrder' || key === 'amountCents') {
          data[key] = Number(value);
        } else if (key === 'cover') {
          data[key] = value === 'true';
        } else if (key === 'freezeBalance') {
          data[key] = value === 'true';
        } else {
          data[key] = value;
        }
      });
      return data;
    }

    document.getElementById('createProductForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      await apiRequest('POST', '/products', payload);
    });

    document.getElementById('updateProductForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      const id = payload.id;
      delete payload.id;
      await apiRequest('PUT', `/products/${id}`, payload);
    });

    document.getElementById('listProductsForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      await apiRequest('GET', '/products', null, payload);
    });

    document.getElementById('addProductImageForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      const id = payload.id;
      delete payload.id;
      await apiRequest('POST', `/products/${id}/images`, payload);
    });

    document.getElementById('createServiceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      await apiRequest('POST', '/services', payload);
    });

    document.getElementById('updateServiceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      const id = payload.id;
      delete payload.id;
      await apiRequest('PUT', `/services/${id}`, payload);
    });

    document.getElementById('listServicesForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      await apiRequest('GET', '/services', null, payload);
    });

    document.getElementById('addServiceImageForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      const id = payload.id;
      delete payload.id;
      await apiRequest('POST', `/services/${id}/images`, payload);
    });

    document.getElementById('listOrdersForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = formToPayload(e.target);
      await apiRequest('GET', '/orders', null, payload);
    });

    document.querySelectorAll('.orderActionForm').forEach((form) => {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const payload = formToPayload(form);
        const orderId = payload.orderId;
        delete payload.orderId;
        const action = form.dataset.action.replace('{id}', orderId);
        const method = 'POST';
        const body = form.classList.contains('extraPayload') ? payload : Object.keys(payload).length ? payload : null;
        await apiRequest(method, action, body);
      });
    });

    document.getElementById('getOrderDetailForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const { orderId } = formToPayload(e.target);
      await apiRequest('GET', `/orders/${orderId}`);
    });
  </script>
</body>
</html>
